From 3f796750b192e62701e91a95f85389f876d1059b Mon Sep 17 00:00:00 2001
From: Tom Gundersen <teg@jklm.no>
Date: Wed, 17 Sep 2014 21:44:56 +0200
Subject: [PATCH] udev: event - explicitly don't read() from invalid fd

This fixes CID #1237641.
---
 src/udev/udev-event.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/udev/udev-event.c b/src/udev/udev-event.c
index 6b8b5a8efa..c8b142077e 100644
--- a/src/udev/udev-event.c
+++ b/src/udev/udev-event.c
@@ -494,6 +494,9 @@ static void spawn_read(struct udev_event *event,
                 for (i = 0; i < fdcount; i++) {
                         int *fd = (int *)ev[i].data.ptr;
 
+                        if (*fd < 0)
+                                continue;
+
                         if (ev[i].events & EPOLLIN) {
                                 ssize_t count;
                                 char buf[4096];
